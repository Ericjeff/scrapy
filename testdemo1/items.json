[
{"content": ["<div class=\"markdown_views\"><p>@(Ruby)[class_eval, instance_eval] <br>\n\u5728<code>irb</code>\u6a21\u5f0f\u4e0b\uff0c<code>instance</code>\u662f\u65e0\u6cd5\u8c03\u7528<code>class_eval</code>\u65b9\u6cd5\u7684\uff0c\u800c\u5728 <code>rails c</code>\u6a21\u5f0f\u4e0b\u662f\u53ef\u4ee5\u7684\u3002</p>\n\n<pre class=\"prettyprint\"><code class=\"language-ruby hljs \"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">A</span></span>\n<span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-constant\">A</span>.instance_eval <span class=\"hljs-keyword\">do</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> </span>test_method1\n    p <span class=\"hljs-string\">'this is from A.instance_eval'</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-constant\">A</span>.class_eval <span class=\"hljs-keyword\">do</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> </span>test_method2\n    p <span class=\"hljs-string\">'this is fromt A.class_eval'</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\n<span class=\"hljs-constant\">A</span>.test_method1 <span class=\"hljs-comment\"># \"this is from A.instance_eval\"</span>\n<span class=\"hljs-constant\">A</span>.test_method2 <span class=\"hljs-comment\"># NoMethodError: undefined method `test_method2' for A:Class</span>\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">B</span>;</span> <span class=\"hljs-keyword\">end</span>\nb = <span class=\"hljs-constant\">B</span>.new\nb.instance_eval <span class=\"hljs-keyword\">do</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> </span>test_method1\n    p <span class=\"hljs-string\">'this is from b.instance_eval'</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\nb.class_eval <span class=\"hljs-keyword\">do</span>\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> </span>test_method2\n    p <span class=\"hljs-string\">'this is from b.class_eval'</span>\n  <span class=\"hljs-keyword\">end</span>\n<span class=\"hljs-keyword\">end</span>\n\nb.test_method1 <span class=\"hljs-comment\"># \"this is from b.instance_eval\"</span>\nb.test_method2 <span class=\"hljs-comment\"># \"this is from b.class_eval\"</span>\n</code></pre>\n\n\n\n<pre class=\"prettyprint\"><code class=\"language-powershell hljs haml\">[32] pry(main)&gt; b.singleton_class.instance_methods.grep /test_/\n=<span class=\"ruby\">&gt; [<span class=\"hljs-symbol\">:test_method1</span>, <span class=\"hljs-symbol\">:test_method2</span>]\n</span># \u5728\u5b9e\u4f8b\u4e0a\u8c03\u7528`class_eval`\u548c`instance_eval`\u6548\u679c\u76f8\u540c\n[33] pry(main)&gt;</code></pre>\n\n\n\n<pre class=\"prettyprint\"><code class=\"language-ruby hljs \">[<span class=\"hljs-number\">38</span>] pry(main)&gt; <span class=\"hljs-variable\">$ </span>b.class_eval\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> </span>class_eval(*args, &amp;block)\n  singleton_class.class_eval(*args, &amp;block)\n<span class=\"hljs-keyword\">end</span>\n[<span class=\"hljs-number\">39</span>] pry(main)&gt;</code></pre>\n\n\n\n<h2 id=\"\u7ed3\u8bba\">\u7ed3\u8bba</h2>\n\n<table>\n<thead>\n<tr>\n  <th align=\"left\"></th>\n  <th align=\"left\"><code>instance_eval</code></th>\n  <th align=\"left\"><code>class_eval</code></th>\n</tr>\n</thead>\n<tbody><tr>\n  <td align=\"left\">class A</td>\n  <td align=\"left\">\u751f\u6210<code>A\u7236\u7c7b</code>\u7684\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u7c7b\u4f3c\u4e8e<code>A</code>\u7684\u7c7b\u65b9\u6cd5,\u6b64\u65f6\u4f1a\u6539\u53d8<code>A.singleton_class</code></td>\n  <td align=\"left\">\u751f\u6210<code>A</code>\u7684\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u6b64\u65f6\u4f1a\u6539\u53d8<code>A</code>\u672c\u8eab\u7684\u7ed3\u6784\uff0c\u4f46\u662f<code>A</code>\u5374\u4e0d\u80fd\u8c03\u7528\u8be5\u65b9\u6cd5</td>\n</tr>\n<tr>\n  <td align=\"left\">instance b</td>\n  <td align=\"left\">\u751f\u6210<code>b\u7236\u7c7b</code>\u7684\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u7c7b\u4f3c\u4e8e<code>b</code>\u7684\u7c7b\u65b9\u6cd5</td>\n  <td align=\"left\">\u540c<code>instance_eval</code>\u6548\u679c\u76f8\u540c</td>\n</tr>\n</tbody></table>\n\n\n<blockquote>\n  <p><strong>\u6ce8\u610f</strong>\uff1ab\u662f\u5b9e\u4f8b\uff0c\u4e0d\u5b58\u5728\u7c7b\u65b9\u6cd5\u3002\u5c31\u53ea\u6709\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u533a\u522b\u5728\u4e8e <strong>instance</strong> \u4e3a\u7236\u7c7b\u6dfb\u52a0\uff0c<strong>class</strong> \u4e3a\u5b50\u7c7b\u6dfb\u52a0</p>\n</blockquote><link rel=\"stylesheet\" href=\"http://static.blog.csdn.net/public/res-min/markdown_views.css?v=2.0\"></div>"], "readNum": ["471"], "title": ["Ruby instance_eval \u4e0e class_eval"]}
]